module MCollective
  module Agent
    class <%= @action_name.capitalize %><RPC::Agent
      action "run" do
        if MCollective::Util.windows?
          begin
            command = '<%= @command %>'
            reply[:out] = %x(#{command})
            reply[:status] = $?.exitstatus
          rescue Process::Error => e
            reply[:status] = "There was a problem executing COMMAND: \`#{command}\`"
            reply[:err] = e.to_s
          end
	else
	  reply[:status] = "Non-Windows node skipped"
	end
      end
    end
  end
end
